(this["webpackJsonparound-web"]=this["webpackJsonparound-web"]||[]).push([[0],{218:function(e,t,a){e.exports=a.p+"static/media/logo.5d5d9eef.svg"},236:function(e,t,a){e.exports=a.p+"static/media/blue-marker.bc8cc4ea.svg"},242:function(e,t,a){e.exports=a(529)},247:function(e,t,a){},528:function(e,t,a){},529:function(e,t,a){"use strict";a.r(t);var o=a(0),n=a.n(o),r=a(9),s=a.n(r),l=(a(247),a(16)),i=a(17),c=a(19),u=a(18),m=a(10),d=a(218),g=a.n(d),p="TOKEN_KEY",h="https://effective-brook-280917.wn.r.appspot.com",f={enableHighAccuracy:!0,maximumAge:3e5,timeout:27e3},v="video",b="unknown",E=a(531),y=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(){return Object(l.a)(this,a),t.apply(this,arguments)}return Object(i.a)(a,[{key:"render",value:function(){return n.a.createElement("header",{className:"App-header"},n.a.createElement("img",{src:g.a,alt:"logo",className:"App-logo"}),n.a.createElement(E.a,{to:"/",className:"App-title"},"Around"),this.props.isLoggedIn?n.a.createElement("a",{className:"logout",onClick:this.props.handleLogout},n.a.createElement(m.a,{type:"logout"})," ","logged in as ",this.props.username,", click to log out"):n.a.createElement("a",{className:"logout"},n.a.createElement(m.a,{type:"login"}),n.a.createElement(E.a,{to:"login"},"Click to log in")," "))}}]),a}(o.Component),w=a(541),O=a(537),L=a(538),S=a(45),k=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(){var e;Object(l.a)(this,a);for(var o=arguments.length,n=new Array(o),r=0;r<o;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))).state={confirmDirty:!1,autoCompleteResult:[]},e.handleConfirmBlur=function(t){var a=t.target.value;e.setState({confirmDirty:e.state.confirmDirty||!!a})},e.compareToFirstPassword=function(t,a,o){var n=e.props.form;a&&a!==n.getFieldValue("password")?o("Two passwords that you enter is inconsistent!"):o()},e.validateToNextPassword=function(t,a,o){var n=e.props.form;a&&e.state.confirmDirty&&n.validateFields(["confirm"],{force:!0}),o()},e.validateUsername=function(e,t,a){},e.handleSubmit=function(t){t.preventDefault(),e.props.form.validateFields((function(e,t){e||(console.log("Received values of form: ",t),fetch("".concat(h,"/signup"),{method:"POST",body:JSON.stringify({username:t.username,password:t.password})}).then((function(e){if(e.ok)return e.text();throw new Error(e.statusText)})).then((function(e){console.log("===== ",e),w.a.success("Registration succeed!")})).catch((function(e){console.error(e),w.a.error("Registration failed.")})))}))},e}return Object(i.a)(a,[{key:"render",value:function(){var e=this.props.form.getFieldDecorator,t={wrapperCol:{xs:{span:24,offset:0},sm:{span:16,offset:8}}};return n.a.createElement(O.a,Object.assign({},{labelCol:{xs:{span:24},sm:{span:8}},wrapperCol:{xs:{span:24},sm:{span:16}}},{onSubmit:this.handleSubmit,className:"register"}),n.a.createElement(O.a.Item,{label:"Username"},e("username",{rules:[{required:!0,message:"Please input your username!"}]})(n.a.createElement(L.a,null))),n.a.createElement(O.a.Item,{label:"Password",hasFeedback:!0},e("password",{rules:[{required:!0,message:"Please input your password!"},{validator:this.validateToNextPassword}]})(n.a.createElement(L.a.Password,null))),n.a.createElement(O.a.Item,{label:"Confirm Password",hasFeedback:!0},e("confirm",{rules:[{required:!0,message:"Please confirm your password!"},{validator:this.compareToFirstPassword}]})(n.a.createElement(L.a.Password,{onBlur:this.handleConfirmBlur}))),n.a.createElement(O.a.Item,t,n.a.createElement(S.a,{type:"primary",htmlType:"submit"},"Register"),n.a.createElement("p",null,"I already have an account, go back to ",n.a.createElement(E.a,{to:"/login"},"login"))))}}]),a}(o.Component),P=O.a.create({name:"register"})(k),j=a(542),I=a(544),N=a(545),C=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(){var e;Object(l.a)(this,a);for(var o=arguments.length,n=new Array(o),r=0;r<o;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))).handleSubmit=function(t){t.preventDefault(),e.props.form.validateFields((function(t,a){t||(console.log("Received values of form: ",a),fetch("".concat(h,"/login"),{method:"POST",body:JSON.stringify({username:a.username,password:a.password})}).then((function(e){if(e.ok)return e.text();throw new Error(e.stateText)})).then((function(t){console.log(t),e.props.handleLoginSucceed(t,a.username),w.a.success("Login Success")})).catch((function(e){console.error(e),w.a.error("Login failed.")})))}))},e}return Object(i.a)(a,[{key:"render",value:function(){var e=this.props.form.getFieldDecorator;return n.a.createElement(O.a,{onSubmit:this.handleSubmit,className:"login-form"},n.a.createElement(O.a.Item,null,e("username",{rules:[{required:!0,message:"Please input your username!"}]})(n.a.createElement(L.a,{prefix:n.a.createElement(m.a,{type:"user",style:{color:"rgba(0,0,0,.25)"}}),placeholder:"Username"}))),n.a.createElement(O.a.Item,null,e("password",{rules:[{required:!0,message:"Please input your Password!"}]})(n.a.createElement(L.a,{prefix:n.a.createElement(m.a,{type:"lock",style:{color:"rgba(0,0,0,.25)"}}),type:"password",placeholder:"Password"}))),n.a.createElement(O.a.Item,null,n.a.createElement(S.a,{type:"primary",htmlType:"submit",className:"login-form-button"},"Log in"),"Or ",n.a.createElement(E.a,{to:"/register"},"register now!")))}}]),a}(o.Component),A=O.a.create({name:"normal_login"})(C),F=a(536),T=a(532),M=a(533),x=a(534),B=a(540),D=a(143),R=a(229),G=a.n(R),U=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(){return Object(l.a)(this,a),t.apply(this,arguments)}return Object(i.a)(a,[{key:"render",value:function(){var e=this.props.images.map((function(e){return Object(D.a)(Object(D.a)({},e),{},{customOverlay:n.a.createElement("div",{className:"gallery-thumbnail"},n.a.createElement("div",null,"".concat(e.user,": ").concat(e.caption)))})}));return n.a.createElement("div",{className:"gallery"},n.a.createElement(G.a,{backdropClosesModal:!0,images:e,enableImageSelection:!1}))}}]),a}(o.Component),W=a(539),_=a(535),q=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(){var e;Object(l.a)(this,a);for(var o=arguments.length,n=new Array(o),r=0;r<o;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))).normFile=function(e){return console.log("Upload event:",e),Array.isArray(e)?e:e&&e.fileList},e.beforeUpload=function(){return!1},e}return Object(i.a)(a,[{key:"render",value:function(){var e=this.props.form.getFieldDecorator,t={labelCol:{span:6},wrapperCol:{span:14}};return n.a.createElement(O.a,t,n.a.createElement(O.a.Item,{label:"Message"},e("message",{rules:[{required:!0,message:"Please input message."}]})(n.a.createElement(L.a,null))),n.a.createElement(O.a.Item,{label:"Image/Video"},n.a.createElement("div",{className:"dropbox"},e("image",{valuePropName:"fileList",getValueFromEvent:this.normFile,rules:[{required:!0,message:"Please select an image."}]})(n.a.createElement(_.a.Dragger,{name:"files",beforeUpload:this.beforeUpload},n.a.createElement("p",{className:"ant-upload-drag-icon"},n.a.createElement(m.a,{type:"inbox"})),n.a.createElement("p",{className:"ant-upload-text"},"Click or drag file to this area to upload"),n.a.createElement("p",{className:"ant-upload-hint"},"Support for a single or bulk upload."))))))}}]),a}(n.a.Component),J=O.a.create()(q),z=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(){var e;Object(l.a)(this,a);for(var o=arguments.length,n=new Array(o),r=0;r<o;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))).state={visible:!1,confirmLoading:!1,isLoggedIn:!0},e.showModal=function(){e.setState({visible:!0,isLoggedIn:e.props.isLoggedIn})},e.handleOk=function(){console.log("ok"),e.form.validateFields((function(t,a){if(console.log(a),!t){var o=localStorage.getItem(p),n=JSON.parse(localStorage.getItem("POS_KEY")),r=n.lat,s=n.lon,l=new FormData;l.set("lat",r),l.set("lon",s),l.set("message",a.message),l.set("image",a.image[0].originFileObj),e.setState({confirmLoading:!0}),fetch("".concat(h,"/post"),{method:"POST",headers:{Authorization:"".concat("Bearer"," ").concat(o)},body:l}).then((function(t){if(t.ok)return e.props.loadNearbyPosts();throw new Error("Failed to create post.")})).then((function(){e.setState({visible:!1,confirmLoading:!1}),e.form.resetFields(),w.a.success("Post created successfully!")})).catch((function(t){console.error(t),w.a.error("Failed to create post."),e.setState({confirmLoading:!1})}))}}))},e.getFormRef=function(t){e.form=t},e.handleCancel=function(){console.log("Clicked cancel button"),e.setState({visible:!1})},e}return Object(i.a)(a,[{key:"render",value:function(){var e=this.state,t=e.visible,a=e.confirmLoading;return e.isLoggedIn?n.a.createElement("div",null,n.a.createElement(S.a,{type:"primary",onClick:this.showModal},"Create New Post"),n.a.createElement(W.a,{title:"Create New Post",visible:t,onOk:this.handleOk,okText:"Create",confirmLoading:a,onCancel:this.handleCancel},n.a.createElement(J,{ref:this.getFormRef}))):n.a.createElement(j.a,{to:"/login"})}}]),a}(o.Component),V=a(54),K=a(236),Y=a.n(K),H=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(){var e;Object(l.a)(this,a);for(var o=arguments.length,n=new Array(o),r=0;r<o;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))).state={isOpen:!1},e.handleToggle=function(){e.setState((function(e){return{isOpen:!e.isOpen}}))},e}return Object(i.a)(a,[{key:"render",value:function(){var e=this.props.post,t=e.user,a=e.message,o=e.url,r=e.location,s=e.type,l=r.lat,i=r.lon,c="image"===s,u=c?void 0:{url:Y.a,scaledSize:new window.google.maps.Size(26,41)};return n.a.createElement(V.Marker,{position:{lat:l,lng:i},onMouseOver:c?this.handleToggle:void 0,onMouseOut:c?this.handleToggle:void 0,onClick:c?void 0:this.handleToggle,icon:u},this.state.isOpen?n.a.createElement(V.InfoWindow,null,n.a.createElement("div",null,c?n.a.createElement("img",{src:o,alt:a,className:"around-marker-image"}):n.a.createElement("video",{src:o,controls:!0,className:"around-marker-video"}),n.a.createElement("p",null,"".concat(t,": ").concat(a)))):null)}}]),a}(n.a.Component),Z=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(){var e;Object(l.a)(this,a);for(var o=arguments.length,n=new Array(o),r=0;r<o;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))).getMapRef=function(t){e.map=t,window.map=t},e.reloadMarker=function(){var t=e.getCenter(),a=e.getRadius();e.props.loadPostsByTopic(t,a)},e}return Object(i.a)(a,[{key:"getCenter",value:function(){var e=this.map.getCenter();return{lat:e.lat(),lon:e.lng()}}},{key:"getRadius",value:function(){var e=this.map.getCenter(),t=this.map.getBounds();if(e&&t){var a=t.getNorthEast(),o=new window.google.maps.LatLng(e.lat(),a.lng());return.001*window.google.maps.geometry.spherical.computeDistanceBetween(e,o)}}},{key:"render",value:function(){var e=JSON.parse(localStorage.getItem("POS_KEY")),t=e.lat,a=e.lon;return n.a.createElement(V.GoogleMap,{ref:this.getMapRef,defaultZoom:11,defaultCenter:{lat:t,lng:a},onDragEnd:this.reloadMarker,onZoomChanged:this.reloadMarker},this.props.posts.map((function(e){return n.a.createElement(H,{post:e,key:e.url})})))}}]),a}(o.Component),X=Object(V.withScriptjs)(Object(V.withGoogleMap)(Z)),$=F.a.TabPane,Q=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(){var e;Object(l.a)(this,a);for(var o=arguments.length,n=new Array(o),r=0;r<o;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))).state={isLoadingGeoLocation:!1,isLoadingPosts:!1,error:"",posts:[],topic:"around"},e.onSuccessLoadGeoLocation=function(t){console.log(t);var a=t.coords,o=a.latitude,n=a.longitude;localStorage.setItem("POS_KEY",JSON.stringify({lat:o,lon:n})),e.setState({isLoadingGeoLocation:!1,error:""}),e.loadNearbyPosts()},e.onFailedLoadGeoLocation=function(){e.setState({isLoadingGeoLocation:!1,error:"Failed to load geo location."})},e.loadNearbyPosts=function(t,a){var o=t||JSON.parse(localStorage.getItem("POS_KEY")),n=o.lat,r=o.lon,s=a||20,l=localStorage.getItem(p);return e.setState({isLoadingPosts:!0,error:""}),fetch("".concat(h,"/search?lat=").concat(n,"&lon=").concat(r,"&range=").concat(s),{method:"GET",headers:{Authorization:"".concat("Bearer"," ").concat(l)}}).then((function(e){if(e.ok)return e.json();throw new Error("Failed to load posts.")})).then((function(t){console.log(t),e.setState({posts:t||[],isLoadingPosts:!1})})).catch((function(t){console.error(t),e.setState({isLoadingPosts:!1,error:t.message})}))},e.loadPostsByTopic=function(t,a){return"around"===e.state.topic?e.loadNearbyPosts(t,a):e.loadFacesAroundTheWolrd()},e.handleTopicChange=function(t){var a=t.target.value;e.setState({topic:a}),"around"===a?e.loadNearbyPosts():e.loadFacesAroundTheWolrd()},e.loadFacesAroundTheWolrd=function(){var t=localStorage.getItem(p);return e.setState({isLoadingPosts:!0,error:""}),fetch("".concat(h,"/cluster?term=face"),{method:"GET",headers:{Authorization:"".concat("Bearer"," ").concat(t)}}).then((function(e){if(e.ok)return e.json();throw new Error("Failed to load posts")})).then((function(t){console.log(t),e.setState({posts:t||[],isLoadingPosts:!1})})).catch((function(t){console.error(t),e.setState({isLoadingPosts:!1,error:t.message})}))},e}return Object(i.a)(a,[{key:"componentDidMount",value:function(){"geolocation"in navigator?navigator.geolocation.getCurrentPosition(this.onSuccessLoadGeoLocation,this.onFailedLoadGeoLocation,f):this.setState({error:"Failed to get location."})}},{key:"getMeta",value:function(e){var t,a=new Image;return a.onload=function(){this.width,t=this.height},a.src=e,t}},{key:"renderImagePosts",value:function(){var e=this,t=this.state.posts.filter((function(e){return"image"===e.type})).map((function(t){var a=e.getMeta(t.url);return{user:t.user,src:t.url,thumbnail:t.url,caption:t.message,thumbnailWidth:a/500*void 0,thumbnailHeight:500}}));return n.a.createElement(U,{images:t})}},{key:"renderVideoPosts",value:function(){var e=this.state.posts;return n.a.createElement(T.a,{gutter:30},e.filter((function(e){return[v,b].includes(e.type)})).map((function(e){return n.a.createElement(M.a,{span:6,key:e.url},n.a.createElement("video",{src:e.url,controls:!0,className:"video-block"}),n.a.createElement("p",null,e.user,": ",e.message))})))}},{key:"renderPosts",value:function(e){var t=this.state,a=t.error,o=t.isLoadingGeoLocation,r=t.isLoadingPosts,s=t.posts;return a||(o?n.a.createElement(x.a,{tip:"Loading geo location..."}):r?n.a.createElement(x.a,{tip:"Loading posts..."}):s.length>0?"image"===e?this.renderImagePosts():this.renderVideoPosts():"No nearby posts")}},{key:"render",value:function(){var e=n.a.createElement(z,{loadNearbyPosts:this.loadPostsByTopic,isLoggedIn:this.props.isLoggedIn});return n.a.createElement("div",null,n.a.createElement(B.a.Group,{onChange:this.handleTopicChange,value:this.state.topic},n.a.createElement(B.a,{value:"around"},"Posts Around Me"),n.a.createElement(B.a,{value:"face"},"Faces Around The World")),n.a.createElement(F.a,{tabBarExtraContent:e,className:"main-tabs"},n.a.createElement($,{tab:"Image Posts",key:"1"},this.renderPosts("image")),n.a.createElement($,{tab:"Video Posts",key:"2"},this.renderPosts(v)),n.a.createElement($,{tab:"Map",key:"3"},n.a.createElement(X,{googleMapURL:"https://maps.googleapis.com/maps/api/js?key=AIzaSyD3CEh9DXuyjozqptVB5LA-dN7MxWWkr9s&v=3.exp&libraries=geometry,drawing,places",loadingElement:n.a.createElement("div",{style:{height:"100%"}}),containerElement:n.a.createElement("div",{style:{height:"600px"}}),mapElement:n.a.createElement("div",{style:{height:"100%"}}),posts:this.state.posts,loadNearbyPosts:this.loadNearbyPosts,loadPostsByTopic:this.loadPostsByTopic}))))}}]),a}(o.Component),ee=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(){var e;Object(l.a)(this,a);for(var o=arguments.length,r=new Array(o),s=0;s<o;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).getLogin=function(){return e.props.isLoggedIn?n.a.createElement(j.a,{to:"/"}):n.a.createElement(A,{handleLoginSucceed:e.props.handleLoginSucceed})},e.getHome=function(){return n.a.createElement(Q,{isLoggedIn:e.props.isLoggedIn})},e}return Object(i.a)(a,[{key:"render",value:function(){return n.a.createElement("div",{className:"main"},n.a.createElement(I.a,null,n.a.createElement(N.a,{path:"/login",render:this.getLogin}),n.a.createElement(N.a,{path:"/register",component:P}),n.a.createElement(N.a,{path:"/",render:this.getHome})))}}]),a}(o.Component),te=(a(528),function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(){var e;Object(l.a)(this,a);for(var o=arguments.length,n=new Array(o),r=0;r<o;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))).state={isLoggedIn:Boolean(localStorage.getItem(p))},e.handleLoginSucceed=function(t,a){localStorage.setItem(p,t),localStorage.setItem("USER_NAME",a),e.setState({isLoggedIn:!0})},e.handleLogout=function(){localStorage.removeItem(p),localStorage.removeItem("USER_NAME"),e.setState({isLoggedIn:!1})},e.handleLogin=function(){},e}return Object(i.a)(a,[{key:"render",value:function(){return n.a.createElement("div",{className:"App"},n.a.createElement(y,{handleLogout:this.handleLogout,isLoggedIn:this.state.isLoggedIn,username:localStorage.getItem("USER_NAME")}),n.a.createElement(ee,{handleLoginSucceed:this.handleLoginSucceed,isLoggedIn:this.state.isLoggedIn}))}}]),a}(o.Component));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var ae=a(543);document.title="Around",s.a.render(n.a.createElement(n.a.StrictMode,null,n.a.createElement(ae.a,null,n.a.createElement(te,null))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[242,1,2]]]);
//# sourceMappingURL=main.13b645ed.chunk.js.map